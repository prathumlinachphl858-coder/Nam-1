-- Skeleton ESP + Line + Health Bar + Team Color | By Nam
-- No Hitbox | Mobile & PC

-- ================= LOAD RAYFIELD =================
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "Nam ESP Control",
    LoadingTitle = "Nam ESP",
    LoadingSubtitle = "by Nam",
    ConfigurationSaving = { Enabled = false }
})

-- ================= SERVICES =================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- ================= SETTINGS =================
local ESP_ENABLED = true
local LINE_ENABLED = true
local HEALTH_ENABLED = true
local ESP_TABLE = {}

-- ================= UTILS =================
local function newLine(thick)
    local l = Drawing.new("Line")
    l.Thickness = thick or 1
    l.Visible = false
    return l
end

-- ================= ESP CREATE =================
local function createESP(player)
    if player == LocalPlayer then return end

    -- Skeleton lines
    local skel = {
        head = newLine(1),
        torso = newLine(2),
        larm = newLine(1),
        rarm = newLine(1),
        lleg = newLine(1),
        rleg = newLine(1),
    }

    local name = Drawing.new("Text")
    name.Size = 13
    name.Center = true
    name.Outline = true
    name.Visible = false

    local line = newLine(1) -- tracer

    local health = newLine(3)

    ESP_TABLE[player] = {
        skel = skel,
        name = name,
        line = line,
        health = health
    }
end

local function removeESP(player)
    if ESP_TABLE[player] then
        for _,v in pairs(ESP_TABLE[player].skel) do v:Remove() end
        ESP_TABLE[player].name:Remove()
        ESP_TABLE[player].line:Remove()
        ESP_TABLE[player].health:Remove()
        ESP_TABLE[player] = nil
    end
end

for _,p in pairs(Players:GetPlayers()) do createESP(p) end
Players.PlayerAdded:Connect(createESP)
Players.PlayerRemoving:Connect(removeESP)

-- ================= RENDER =================
RunService.RenderStepped:Connect(function()
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

    for player,esp in pairs(ESP_TABLE) do
        local char = player.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        local hrp = char and char:FindFirstChild("HumanoidRootPart")

        if char and hum and hum.Health > 0 and hrp then
            -- Team color
            local teamColor = Color3.fromRGB(255,0,0)
            if player.Team and player.Team.TeamColor then
                teamColor = player.Team.TeamColor.Color
            end

            -- Get joints
            local function wp(part)
                local p = char:FindFirstChild(part)
                if not p then return nil end
                local v, on = Camera:WorldToViewportPoint(p.Position)
                if not on then return nil end
                return Vector2.new(v.X, v.Y), v.Z
            end

            local head = wp("Head")
            local torso = wp("UpperTorso") or wp("Torso")
            local lhand = wp("LeftHand") or wp("Left Arm")
            local rhand = wp("RightHand") or wp("Right Arm")
            local lfoot = wp("LeftFoot") or wp("Left Leg")
            local rfoot = wp("RightFoot") or wp("Right Leg")

            -- ===== Skeleton =====
            if ESP_ENABLED and head and torso then
                local function draw(l, a, b)
                    if a and b then
                        l.From = a
                        l.To = b
                        l.Color = teamColor
                        l.Visible = true
                    else
                        l.Visible = false
                    end
                end

                draw(esp.skel.head, head, torso)
                draw(esp.skel.torso, torso, Vector2.new(torso.X, torso.Y + 1))
                draw(esp.skel.larm, torso, lhand)
                draw(esp.skel.rarm, torso, rhand)
                draw(esp.skel.lleg, torso, lfoot)
                draw(esp.skel.rleg, torso, rfoot)

                esp.name.Text = player.Name
                esp.name.Color = teamColor
                esp.name.Position = Vector2.new(head.X, head.Y - 14)
                esp.name.Visible = true
            else
                for _,l in pairs(esp.skel) do l.Visible = false end
                esp.name.Visible = false
            end

            -- ===== Health Bar =====
            if HEALTH_ENABLED and torso then
                local hp = hum.Health / hum.MaxHealth
                local barH = 40 * hp
                esp.health.From = Vector2.new(torso.X - 12, torso.Y + 20)
                esp.health.To = Vector2.new(torso.X - 12, torso.Y + 20 - barH)
                esp.health.Color = teamColor
                esp.health.Visible = true
            else
                esp.health.Visible = false
            end

            -- ===== Line =====
            local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
            if LINE_ENABLED and onScreen then
                esp.line.From = center
                esp.line.To = Vector2.new(pos.X, pos.Y)
                esp.line.Color = teamColor
                esp.line.Visible = true
            else
                esp.line.Visible = false
            end
        else
            for _,l in pairs(esp.skel) do l.Visible = false end
            esp.name.Visible = false
            esp.line.Visible = false
            esp.health.Visible = false
        end
    end
end)

-- ================= UI =================
local Tab = Window:CreateTab("ESP", 4483362458)

Tab:CreateToggle({
    Name = "ESP (Skeleton)",
    CurrentValue = true,
    Callback = function(v) ESP_ENABLED = v end
})

Tab:CreateToggle({
    Name = "Line (Tracer)",
    CurrentValue = true,
    Callback = function(v) LINE_ENABLED = v end
})

Tab:CreateToggle({
    Name = "Health Bar",
    CurrentValue = true,
    Callback = function(v) HEALTH_ENABLED = v end
})
