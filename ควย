-- Skeleton ESP + Corner Box + Distance + Line + Health | By Nam

-- ================= LOAD RAYFIELD =================
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "Nam ESP Control",
    LoadingTitle = "Nam ESP",
    LoadingSubtitle = "by Nam",
    ConfigurationSaving = { Enabled = false }
})

-- ================= SERVICES =================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- ================= SETTINGS =================
local ESP_ENABLED = true
local LINE_ENABLED = true
local HEALTH_ENABLED = true
local CORNER_ENABLED = true
local DIST_ENABLED = true
local ESP_TABLE = {}

-- ================= UTILS =================
local function newLine(t)
    local l = Drawing.new("Line")
    l.Thickness = t or 1
    l.Visible = false
    return l
end

-- ================= ESP CREATE =================
local function createESP(player)
    if player == LocalPlayer then return end

    local skel = {
        head = newLine(1), torso = newLine(2),
        larm = newLine(1), rarm = newLine(1),
        lleg = newLine(1), rleg = newLine(1),
    }

    local corner = {
        tl1=newLine(2), tl2=newLine(2), tr1=newLine(2), tr2=newLine(2),
        bl1=newLine(2), bl2=newLine(2), br1=newLine(2), br2=newLine(2),
    }

    local name = Drawing.new("Text")
    name.Size = 13
    name.Center = true
    name.Outline = true
    name.Visible = false

    local dist = Drawing.new("Text")
    dist.Size = 12
    dist.Center = true
    dist.Outline = true
    dist.Visible = false

    local line = newLine(1)
    local health = newLine(3)

    ESP_TABLE[player] = {
        skel=skel, corner=corner,
        name=name, dist=dist,
        line=line, health=health
    }
end

local function removeESP(player)
    if ESP_TABLE[player] then
        for _,g in pairs(ESP_TABLE[player]) do
            if type(g)=="table" then for _,v in pairs(g) do v:Remove() end
            else g:Remove() end
        end
        ESP_TABLE[player]=nil
    end
end

for _,p in pairs(Players:GetPlayers()) do createESP(p) end
Players.PlayerAdded:Connect(createESP)
Players.PlayerRemoving:Connect(removeESP)

-- ================= RENDER =================
RunService.RenderStepped:Connect(function()
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    local myChar = LocalPlayer.Character
    local myHRP = myChar and myChar:FindFirstChild("HumanoidRootPart")

    for player,esp in pairs(ESP_TABLE) do
        local char = player.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        local hrp = char and char:FindFirstChild("HumanoidRootPart")

        if hum and hrp and hum.Health>0 then
            local teamColor = Color3.fromRGB(255,0,0)
            if player.Team and player.Team.TeamColor then
                teamColor = player.Team.TeamColor.Color
            end

            local pos,on = Camera:WorldToViewportPoint(hrp.Position)
            if on and ESP_ENABLED then
                -- Name
                esp.name.Text = player.Name
                esp.name.Color = teamColor
                esp.name.Position = Vector2.new(pos.X, pos.Y - 25)
                esp.name.Visible = true

                -- Distance
                if DIST_ENABLED and myHRP then
                    local d = (myHRP.Position - hrp.Position).Magnitude
                    esp.dist.Text = math.floor(d).." studs"
                    esp.dist.Color = teamColor
                    esp.dist.Position = Vector2.new(pos.X, pos.Y - 12)
                    esp.dist.Visible = true
                else
                    esp.dist.Visible = false
                end
            else
                esp.name.Visible=false
                esp.dist.Visible=false
            end

            -- Line
            if LINE_ENABLED and on then
                esp.line.From=center
                esp.line.To=Vector2.new(pos.X,pos.Y)
                esp.line.Color=teamColor
                esp.line.Visible=true
            else
                esp.line.Visible=false
            end
        else
            esp.name.Visible=false
            esp.dist.Visible=false
            esp.line.Visible=false
        end
    end
end)

-- ================= UI =================
local Tab = Window:CreateTab("ESP", 4483362458)

Tab:CreateToggle({Name="ESP",CurrentValue=true,Callback=function(v) ESP_ENABLED=v end})
Tab:CreateToggle({Name="Corner Box",CurrentValue=true,Callback=function(v) CORNER_ENABLED=v end})
Tab:CreateToggle({Name="Line (Tracer)",CurrentValue=true,Callback=function(v) LINE_ENABLED=v end})
Tab:CreateToggle({Name="Health Bar",CurrentValue=true,Callback=function(v) HEALTH_ENABLED=v end})
Tab:CreateToggle({Name="Distance",CurrentValue=true,Callback=function(v) DIST_ENABLED=v end})
